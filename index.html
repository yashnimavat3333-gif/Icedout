<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
  
  <!-- Facebook in-app browser optimizations -->
  <meta property="fb:app_id" content="">
  <meta name="format-detection" content="telephone=no">
  <meta name="mobile-web-app-capable" content="yes">

  <!-- Primary Meta Tags -->
  <title>Iceyout | Premium Luxury Watches & Timepieces</title>
  <meta name="description"
    content="Discover exquisite premium watches from Iceyout. Luxury timepieces crafted with precision, featuring Swiss movements, premium materials, and timeless design.">
  <meta name="keywords"
    content="luxury watches, premium watches, Swiss watches, automatic watches, dress watches, dive watches, luxury timepieces, mens watches, womens watches">
  <meta name="author" content="Iceyout">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://iceyout.com/">
  <meta property="og:title" content="Iceyout | Premium Luxury Watches & Timepieces">
  <meta property="og:description"
    content="Discover exquisite premium watches from Iceyout. Luxury timepieces crafted with precision, featuring Swiss movements, premium materials, and timeless design.">
  <meta property="og:image" content="https://iceyout.com/images/og-image.jpg">
  <meta property="og:image:secure_url" content="https://iceyout.com/images/og-image.jpg">
  <meta property="og:image:alt" content="Iceyout Luxury Watch Collection">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:type" content="image/jpeg">

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://iceyout.com/">
  <meta property="twitter:title" content="Iceyout | Premium Luxury Watches & Timepieces">
  <meta property="twitter:description"
    content="Discover exquisite premium watches from Iceyout. Luxury timepieces crafted with precision, featuring Swiss movements, premium materials, and timeless design.">
  <meta property="twitter:image" content="https://iceyout.com/images/twitter-image.jpg">

  <!-- Additional SEO Meta Tags -->
  <meta name="robots" content="index, follow, max-image-preview:large">
  <meta name="theme-color" content="#000000">
  <link rel="canonical" href="https://iceyout.com/">

  <!-- Structured Data (JSON-LD) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "LuxuryGoodsStore",
    "name": "Iceyout",
    "description": "Premium luxury watches and timepieces",
    "url": "https://iceyout.com",
    "logo": "https://iceyout.com/logo.svg",
    "priceRange": "$$$",
    "address": {
      "@type": "PostalAddress",
      "addressCountry": "Switzerland"
    },
    "sameAs": [
      "https://www.instagram.com/iceyout",
      "https://www.facebook.com/iceyout",
      "https://twitter.com/iceyout"
    ]
  }
  </script>

  <!-- Favicon & App Icons -->
  <link rel="icon" type="image/svg+xml" href="/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">

  <!-- Preconnect for critical domains -->
  <link rel="preconnect" href="https://www.googletagmanager.com">
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="preconnect" href="https://fra.cloud.appwrite.io">
  <link rel="preconnect" href="https://cdn.debugbear.com" crossorigin>
  <link rel="preconnect" href="https://connect.facebook.net" crossorigin>
  <link rel="dns-prefetch" href="https://www.googletagmanager.com">
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="https://cdn.debugbear.com">
  <link rel="dns-prefetch" href="https://connect.facebook.net">
  <link rel="preconnect" href="https://www.clarity.ms" crossorigin>
  <link rel="dns-prefetch" href="https://www.clarity.ms">

  <!-- Preload Appwrite SDK so it's ready before checkout (critical for in-app browsers) -->
  <link rel="preload" href="https://cdn.jsdelivr.net/npm/appwrite@14.0.1" as="script">
  <!-- Also preconnect to Appwrite cloud API -->
  <link rel="preconnect" href="https://cloud.appwrite.io">
  <link rel="dns-prefetch" href="https://cloud.appwrite.io">

  <!-- CRITICAL: Global error handler for Meta in-app browsers (Instagram + Facebook) -->
  <!-- This MUST run before ANY other script to prevent layout shifts from JS errors -->
  <script>
    // CRITICAL FIX: Prevent runtime errors in Meta in-app browsers (Instagram + Facebook)
    // Covers: _AutofillCallbackHandler, webkit.messageHandlers, Script error., Load failed,
    //         .at() polyfill, Invalid regular expression (third-party), cross-origin noise
    (function() {
      'use strict';
      if (typeof window === 'undefined') return;

      // ── 1. _AutofillCallbackHandler polyfill (iOS WebKit autofill bug) ──
      // Safari/WebKit autofill calls this variable; if missing → "Can't find variable" error
      try {
        if (typeof window._AutofillCallbackHandler === 'undefined') {
          window._AutofillCallbackHandler = function() { return; };
        }
        // Also cover the prefixed variant iOS sometimes uses
        if (typeof window.__AutofillCallbackHandler === 'undefined') {
          window.__AutofillCallbackHandler = function() { return; };
        }
      } catch (e) { /* silent */ }

      // ── 2. Array.prototype.at polyfill (Safari <15.4, FB/IG in-app WebViews) ──
      // Fixes: "o.entries.at is not a function" from DebugBear RUM and other libs
      try {
        if (!Array.prototype.at) {
          Array.prototype.at = function(n) {
            n = Math.trunc(n) || 0;
            if (n < 0) n += this.length;
            if (n < 0 || n >= this.length) return undefined;
            return this[n];
          };
        }
        // Also polyfill for NodeList, String, TypedArray (same pattern)
        if (typeof NodeList !== 'undefined' && !NodeList.prototype.at) {
          NodeList.prototype.at = Array.prototype.at;
        }
        if (!String.prototype.at) {
          String.prototype.at = function(n) {
            n = Math.trunc(n) || 0;
            if (n < 0) n += this.length;
            if (n < 0 || n >= this.length) return undefined;
            return this[n];
          };
        }
      } catch (e) { /* silent */ }

      // ── 3. Detect Meta in-app browsers ──
      var ua = navigator.userAgent || navigator.vendor || '';
      var isMetaBrowser = /FBAN|FBAV|FB_IAB|FB4A|Instagram|Messenger/i.test(ua);

      // ── 4. Safe webkit.messageHandlers stubs ──
      if (!window.webkit) {
        window.webkit = {};
      }
      if (!window.webkit.messageHandlers) {
        window.webkit.messageHandlers = {};
      }

      var safeHandler = {
        postMessage: function() { return; }
      };

      var commonHandlers = [
        'bridge', 'native', 'app', 'webview', 'analytics', 'tracking', 'event',
        'selectedDebugHandler', 'advertisingIdentifier', 'autoFill'
      ];
      commonHandlers.forEach(function(name) {
        if (!window.webkit.messageHandlers[name]) {
          window.webkit.messageHandlers[name] = safeHandler;
        }
      });

      // ── 5. Global error handler — suppress ALL non-actionable errors ──
      // Capture phase so we intercept before RUM/monitoring scripts re-throw
      window.addEventListener('error', function(e) {
        var msg = '';
        if (e.message) {
          msg = String(e.message);
        } else if (e.error && e.error.message) {
          msg = String(e.error.message);
        }

        var suppress = false;

        // a) Cross-origin "Script error." — no useful info, just noise from CDN scripts
        if (msg === 'Script error.' || msg === 'Script error') {
          suppress = true;
        }

        // b) "Load failed" — third-party script blocked by network/ad-blocker/in-app browser
        if (msg === 'Load failed' || msg.indexOf('Load failed') === 0) {
          suppress = true;
        }

        // c) webkit / messageHandlers errors
        if (msg.indexOf('webkit') !== -1 && (msg.indexOf('messageHandlers') !== -1 || msg.indexOf('undefined') !== -1)) {
          suppress = true;
        }
        if (msg.indexOf('messageHandlers') !== -1) {
          suppress = true;
        }

        // d) _AutofillCallbackHandler not found (iOS autofill bug)
        if (msg.indexOf('AutofillCallbackHandler') !== -1) {
          suppress = true;
        }

        // e) .at() related (fallback if polyfill somehow missed)
        if (msg.indexOf('.at is not a function') !== -1 || msg.indexOf('.at is undefined') !== -1) {
          suppress = true;
        }

        // f) "Invalid regular expression" from third-party scripts
        //    Only suppress when the error comes from a non-first-party script
        if (msg.indexOf('Invalid regular expression') !== -1) {
          var fileName = (e.filename || '').toLowerCase();
          var isOurCode = fileName.indexOf('iceyout') !== -1 ||
                          fileName.indexOf('localhost') !== -1 ||
                          fileName.indexOf('/src/') !== -1;
          if (!isOurCode) {
            suppress = true;
          }
        }

        if (suppress) {
          e.preventDefault();
          e.stopPropagation();
          e.stopImmediatePropagation();
          return false;
        }
      }, true);

      // ── 6. Unhandled promise rejection handler ──
      window.addEventListener('unhandledrejection', function(e) {
        var msg = '';
        if (e.reason) {
          if (typeof e.reason === 'string') {
            msg = e.reason;
          } else if (typeof e.reason === 'object' && e.reason.message) {
            msg = String(e.reason.message);
          }
        }

        if (msg.indexOf('webkit') !== -1 ||
            msg.indexOf('messageHandlers') !== -1 ||
            msg.indexOf('AutofillCallbackHandler') !== -1 ||
            msg.indexOf('.at is not a function') !== -1 ||
            msg === 'Script error.' ||
            msg === 'Script error' ||
            msg === 'Load failed') {
          e.preventDefault();
          return false;
        }
      });

      // ── 7. Protect Object.defineProperty from webkit failures ──
      try {
        var origDP = Object.defineProperty;
        Object.defineProperty = function(obj, prop, desc) {
          try {
            return origDP.call(this, obj, prop, desc);
          } catch (e) {
            if (String(e.message || '').indexOf('webkit') !== -1) {
              return obj;
            }
            throw e;
          }
        };
      } catch (e) { /* silent */ }

      // ── 8. Prevent Meta-injected DOM mutations from causing CLS ──
      if (isMetaBrowser && typeof document !== 'undefined') {
        var observer = new MutationObserver(function(mutations) {
          mutations.forEach(function(mutation) {
            mutation.addedNodes.forEach(function(node) {
              if (node.nodeType === 1) {
                var isMetaInjected = node.getAttribute && (
                  node.getAttribute('data-meta-injected') ||
                  (node.src && (node.src.indexOf('facebook.com') !== -1 || node.src.indexOf('instagram.com') !== -1)) ||
                  (node.className && (String(node.className).indexOf('fb') !== -1 || String(node.className).indexOf('ig') !== -1))
                );

                if (isMetaInjected || (node.tagName && (node.tagName === 'IFRAME' || node.tagName === 'SCRIPT'))) {
                  try {
                    if (node.style) {
                      node.style.contain = 'layout style paint';
                      node.style.willChange = 'auto';
                    }
                    if (node.getAttribute && !node.getAttribute('data-meta-injected')) {
                      node.setAttribute('data-meta-injected', 'true');
                    }
                  } catch (e) { /* silent */ }
                }
              }
            });
          });
        });

        if (document.body) {
          observer.observe(document.body, { childList: true, subtree: true });
        } else {
          document.addEventListener('DOMContentLoaded', function() {
            if (document.body) {
              observer.observe(document.body, { childList: true, subtree: true });
            }
          }, { once: true });
        }
      }
    })();
  </script>

  <!-- Meta Pixel - Iceyout Main Pixel (ID: 2057245685052975) -->
  <!-- Loaded asynchronously, safe for Meta in-app browsers, no CLS -->
  <script>
    (function() {
      'use strict';
      if (typeof window === 'undefined') return;
      
      // CRITICAL: Defensive guard against webkit.messageHandlers errors
      // Meta Pixel may access webkit APIs in Meta browsers
      try {
        // Ensure webkit.messageHandlers exists (already set by previous script)
        if (!window.webkit) window.webkit = {};
        if (!window.webkit.messageHandlers) window.webkit.messageHandlers = {};
      } catch (e) {
        // Silently continue
      }
      
      // Meta Pixel base code - async load, no blocking
      var pixelId = '2057245685052975';
      
      // Initialize fbq queue immediately (before script loads)
      !function(f,b,e,v,n,t,s)
      {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
      n.callMethod.apply(n,arguments):n.queue.push(arguments)};
      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
      n.queue=[];t=b.createElement(e);t.async=!0;
      t.src=v;s=b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t,s)}(window, document,'script',
      'https://connect.facebook.net/en_US/fbevents.js');
      
      // Track PageView immediately after fbq is initialized
      try {
        if (typeof window.fbq === 'function') {
          window.fbq('init', pixelId);
          window.fbq('track', 'PageView');
        }
      } catch (e) {
        // Silently fail - Pixel will retry on next page load
      }
      
      // CRITICAL: Meta Pixel event tracking helper functions
      // Safe wrappers that queue events if Pixel not loaded yet
      
      // Helper: Ensure fbq exists (queue if not ready)
      function ensureFbq() {
        if (typeof window.fbq !== 'function') {
          if (!window.fbq) {
            window.fbq = function() {
              (window.fbq.q = window.fbq.q || []).push(arguments);
            };
          }
        }
      }
      
      // ViewContent: Track when product page is viewed
      window.trackMetaPixelViewContent = function(productId, productName, value, currency, category) {
        try {
          ensureFbq();
          var params = {
            content_ids: [String(productId || '')],
            content_name: String(productName || ''),
            content_type: 'product',
            currency: String(currency || 'USD'),
            value: typeof value === 'number' && value > 0 ? value : 0
          };
          if (category) params.content_category = String(category);
          window.fbq('track', 'ViewContent', params);
        } catch (e) {
          if (window.location && (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1')) {
            console.warn('Meta Pixel ViewContent tracking failed:', e);
          }
        }
      };
      
      // AddToCart: Track when item is added to cart
      window.trackMetaPixelAddToCart = function(productId, productName, value, currency, quantity, category) {
        try {
          ensureFbq();
          var params = {
            content_ids: [String(productId || '')],
            content_name: String(productName || ''),
            content_type: 'product',
            currency: String(currency || 'USD'),
            value: typeof value === 'number' && value > 0 ? value : 0,
            num_items: typeof quantity === 'number' && quantity > 0 ? quantity : 1
          };
          if (category) params.content_category = String(category);
          window.fbq('track', 'AddToCart', params);
        } catch (e) {
          if (window.location && (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1')) {
            console.warn('Meta Pixel AddToCart tracking failed:', e);
          }
        }
      };
      
      // InitiateCheckout: Track when checkout page loads
      window.trackMetaPixelInitiateCheckout = function(value, currency, numItems, contentIds) {
        try {
          ensureFbq();
          var params = {
            currency: String(currency || 'USD'),
            value: typeof value === 'number' && value > 0 ? value : 0,
            num_items: typeof numItems === 'number' && numItems > 0 ? numItems : 0
          };
          if (Array.isArray(contentIds) && contentIds.length > 0) {
            params.content_ids = contentIds.map(function(id) { return String(id); });
          }
          window.fbq('track', 'InitiateCheckout', params);
        } catch (e) {
          if (window.location && (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1')) {
            console.warn('Meta Pixel InitiateCheckout tracking failed:', e);
          }
        }
      };
      
      // Purchase: Track completed purchase (enhanced with product data)
      window.trackMetaPixelPurchase = function(value, currency, contentIds, contentNames, quantities) {
        try {
          ensureFbq();
          var params = {
            currency: String(currency || 'USD'),
            value: typeof value === 'number' && value > 0 ? value : 0
          };
          if (Array.isArray(contentIds) && contentIds.length > 0) {
            params.content_ids = contentIds.map(function(id) { return String(id); });
          }
          if (Array.isArray(contentNames) && contentNames.length > 0) {
            params.contents = contentNames.map(function(name, idx) {
              return {
                id: String(contentIds && contentIds[idx] ? contentIds[idx] : ''),
                quantity: typeof quantities === 'number' ? quantities : (Array.isArray(quantities) && quantities[idx] ? quantities[idx] : 1),
                item_price: value / (Array.isArray(quantities) ? quantities.reduce(function(a, b) { return a + b; }, 0) : 1)
              };
            });
          }
          window.fbq('track', 'Purchase', params);
        } catch (e) {
          if (window.location && (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1')) {
            console.warn('Meta Pixel Purchase tracking failed:', e);
          }
        }
      };
    })();
  </script>

  <!-- Defer non-critical scripts to prevent render blocking -->
  <script>
    // Guard against undefined errors in in-app browsers
    if (typeof window !== 'undefined' && typeof document !== 'undefined') {
      // Load Google Analytics after first interaction or 5 seconds
      function loadAnalytics() {
        try {
          const script = document.createElement('script');
          script.async = true;
          script.defer = true;
          script.src = 'https://www.googletagmanager.com/gtag/js?id=G-X03NVF8TXL';
          
          script.onload = function() {
            try {
              if (typeof window !== 'undefined') {
                window.dataLayer = window.dataLayer || [];
                function gtag() { 
                  if (window.dataLayer) {
                    window.dataLayer.push(arguments); 
                  }
                }
                window.gtag = gtag;
                gtag('js', new Date());
                gtag('config', 'G-X03NVF8TXL', { send_page_view: false });
              }
            } catch (e) {
              // Silently fail
            }
          };
          
          if (document.head) {
            document.head.appendChild(script);
          }
        } catch (e) {
          // Silently fail
        }
      }
      
      // Load after first interaction or 5 seconds
      var analyticsLoaded = false;
      var loadAnalyticsOnce = function() {
        if (!analyticsLoaded) {
          analyticsLoaded = true;
          loadAnalytics();
        }
      };
      
      ['click', 'touchstart', 'scroll'].forEach(function(evt) {
        document.addEventListener(evt, loadAnalyticsOnce, { passive: true, once: true });
      });
      
      setTimeout(function() {
        if (!analyticsLoaded) {
          loadAnalyticsOnce();
        }
      }, 5000);
    }
  </script>

  <!-- EmailJS - Load after first interaction (non-critical) -->
  <script>
    if (typeof window !== 'undefined' && typeof document !== 'undefined') {
      function loadEmailJS() {
        try {
          const emailScript = document.createElement('script');
          emailScript.type = 'text/javascript';
          emailScript.src = 'https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js';
          emailScript.async = true;
          emailScript.defer = true;
          emailScript.onload = function() {
            try {
              if (typeof window !== 'undefined' && window.emailjs) {
                emailjs.init({
                  publicKey: "6CgXUh7CTnIOoZsLT",
                });
              }
            } catch (e) {
              // Silently fail
            }
          };
          if (document.head) {
            document.head.appendChild(emailScript);
          }
        } catch (e) {
          // Silently fail
        }
      }
      
      // Load after first interaction or 5 seconds
      var emailJSLoaded = false;
      var loadEmailJSOnce = function() {
        if (!emailJSLoaded) {
          emailJSLoaded = true;
          loadEmailJS();
        }
      };
      
      ['click', 'touchstart'].forEach(function(evt) {
        document.addEventListener(evt, loadEmailJSOnce, { passive: true, once: true });
      });
      
      setTimeout(function() {
        if (!emailJSLoaded) {
          loadEmailJSOnce();
        }
      }, 5000);
    }
  </script>

  <!-- DebugBear RUM - Real User Monitoring (async, non-blocking) -->
  <!-- Loads immediately but async, does not block initial render or hero image -->
  <script>
    (function(){var dbpr=100;if(Math.random()*100>100-dbpr){var d="dbbRum",w=window,o=document,a=addEventListener,scr=o.createElement("script");scr.async=!0;w[d]=w[d]||[];w[d].push(["presampling",dbpr]);["error","unhandledrejection"].forEach(function(t){a(t,function(e){w[d].push([t,e])});});scr.src="https://cdn.debugbear.com/mGylJjrwEf9j.js";o.head.appendChild(scr);}})()
  </script>

  <!-- Microsoft Clarity - Session recordings & heatmaps (Project ID: uynsdkk298) -->
  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "uynsdkk298");
  </script>
</head>

<body>
  <div id="root"></div>
  <script type="module" src="/src/main.jsx"></script>

  <!-- Progressive enhancement for SEO -->
  <noscript>
    <div
      style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 9999; padding: 20px;">
      <h1>Iceyout Premium Watches</h1>
      <p>For the best experience, please enable JavaScript. In the meantime, you can:</p>
      <ul>
        <li><a href="/collections">View our watch collections</a></li>
        <li><a href="/about">Learn about Iceyout craftsmanship</a></li>
        <li><a href="/contact">Contact our concierge service</a></li>
      </ul>
      <p>Or call us at: +1-800-ICEOUT</p>
    </div>
  </noscript>
</body>

</html>